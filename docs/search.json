[
  {
    "objectID": "Tutorial.html",
    "href": "Tutorial.html",
    "title": "Drawing Insight with Tinyplot Graphics",
    "section": "",
    "text": "Author bio\nOur goal:"
  },
  {
    "objectID": "Tutorial.html#syntax-overview",
    "href": "Tutorial.html#syntax-overview",
    "title": "Drawing Insight with Tinyplot Graphics",
    "section": "Syntax Overview",
    "text": "Syntax Overview\nRoughly speaking, the call form is\ntinyplot(formula,[optional conditioning], type=plot type, \n   [optional faceting], data=dataset,\n   [optional base-R plot parameters])\nMost of these are named arguments; make sure you specify the names.\nOne can abbreviate tinyplot to plt.\nPlot type can be specified either as a call, e.g. type_lm(), or via a quoted string shortcut, e.g. “lm”. Note: The type argument must come before the data argument.\nLayering can be done via tinyplot_add."
  },
  {
    "objectID": "Tutorial.html#examples",
    "href": "Tutorial.html#examples",
    "title": "Drawing Insight with Tinyplot Graphics",
    "section": "Examples",
    "text": "Examples\n\nThe Census dataset\nThese are programmers and engineers in Silicon Valley in the 2000 census. Here occ is one of 6 job categories. My primary interest here is investigating possible sex discrimination in salaries. Note: Census data top-coded income at $300,000.\nSo, let’s try it on the svcensus dataset from my qeML package.\n\nsuppressPackageStartupMessages(library(qeML))\ndata(svcensus)\nhead(svcensus,5)\n\n       age     educ occ wageinc wkswrkd gender\n1 50.30082 zzzOther 102   75000      52 female\n2 41.10139 zzzOther 101   12300      20   male\n3 24.67374 zzzOther 102   15400      52 female\n4 50.19951 zzzOther 100       0      52   male\n5 51.18112 zzzOther 100     160       1 female\n\n\n\n\nCompare densities across groups\n\n# plot histograms (area 1.0)\nlibrary(tinyplot)\n\nWarning: package 'tinyplot' was built under R version 4.4.2\n\ntinyplot(~ wageinc | gender, data=svcensus,type='density')\n\n\n\n\n\n\n\n\nMen seem to have a slight edge in the middle income levels, but possibly a substantial one at the very high levels.\nBut of course a big factor is wkswrkd, the number of weeks worked. If there is a substantial difference between the sexes in this variable, it could bias our analysis.\n\ntinyplot( ~ wkswrkd | gender,data=svcensus,type='density')\n\n\n\n\n\n\n\n\nNot much difference in general, but more women seemed to report 0 weeks worked.\n\n\nFit and display a linear model\nIt is then natural to correct for number of weeks worked via linear regression. For each gender, fit a linear model predicting wageinc from wkswrkd:\n\ntinyplot(wageinc ~ wkswrkd| gender,data=svcensus,type='lm')\n\n\n\n\n\n\n\n\nAh, yes, for those who worked most or all of the year, we see a male advantage. That is, for a given number of weeks worked, the mean salary is higher for men.\nWhat about possible age differences?\n\ntinyplot(wageinc ~ age | gender, data=svcensus,type='lm')\n\n\n\n\n\n\n\n\nVery few elderly in Silicon Valley! Thus very wide confidence bands at the older level. Similarly, the even wider confidence band for women reflects the fact that women are less numerous in this dataset.\nThe conference bands are informative, but they may result in some clutter in more complicated graphs. We can suppress those bands:\n\ntinyplot(wageinc ~ age | gender, type=type_lm(se = FALSE), data=svcensus)\n\n\n\n\n\n\n\n\nA clear separation between men and women, with mean wages being consistently lower for women.\n\n\nModel-free estimation of a regression function\nBut…should we apply a linear model so carelessly? Let’s try a model-free estimate of the regression functions, using R’s loess, which divides the X-axis into intervals and then fits a local polynomial model in each interval.\n\ntinyplot(wageinc ~ age | gender, type=type_loess(se=FALSE),data=svcensus)\n\n\n\n\n\n\n\n\nWhoa! Not linear, not even monotonic. One of the factors underlying this nonmonotonicity may be age discrimination.\n\n\n\n\n\n\nSample Size Issues\n\n\n\nNever assume a linear model willy-nilly. While no relation in practice is exactly linear and slight discrepancies are fine, the relation may be substantially nonlinear, even substantially nonmonotonic..\n\n\nAt any rate, men definitely seem to be paid more, particularly in their early 40s.\n\n\nFaceting\nWe can facet by, say, occupation.\n\ntinyplot(~ wageinc, type='density',data = svcensus, facet=~occ)\n\n\n\n\n\n\n\n\nOccupation codes 102 and 141 pay the most.\nWe can break it down further by gender:\n\ntinyplot(~ wageinc | gender, type='density',data = svcensus, facet=~occ)\n\n\n\n\n\n\n\n\nIn several occupations, notably code 140, the top-code wages seem to be disproportionately male.\nWe can facet on two variables:\n\ntinyplot(~ wageinc | gender, type='density',data = svcensus,\nfacet=~occ:gender)\n\n\n\n\n\n\n\n\nHow about age? Do the sex-specific relations between wageinc and age vary from one occupation to another?\n\ntinyplot(wageinc ~ age | gender, type = type_loess(se=FALSE), \n   data = svcensus, facet=~occ)\n\n\n\n\n\n\n\n\nThe male advantage seems to be especially pronounced for occupation code 140.\n\n\n\n\n\n\nPesky Syntax Rules\n\n\n\nDon’t forget the tilde in specifying the faceting variables!\n\n\n\n\nThe Iranian Churn dataset\nLet’s look at the Iranian Churn data in qeML, on customer loyalty in the financial sector.\n\ndata(IranianChurn)\nhead(iranChurn)\n\n  CreditScore Geography Gender Age Tenure   Balance NumOfProducts HasCrCard\n1         619    France Female  42      2      0.00             1         1\n2         608     Spain Female  41      1  83807.86             1         0\n3         502    France Female  42      8 159660.80             3         1\n4         699    France Female  39      1      0.00             2         0\n5         850     Spain Female  43      2 125510.82             1         1\n6         645     Spain   Male  44      8 113755.78             2         1\n  IsActiveMember EstimatedSalary Exited\n1              1       101348.88      1\n2              1       112542.58      0\n3              0       113931.57      1\n4              0        93826.63      0\n5              1        79084.10      0\n6              0       149756.71      1\n\n\n\n\nCompare densities across groups\n\ntinyplot(~ Balance | Geography, type='density',data=iranChurn)\n\n\n\n\n\n\n\n\nInteresting! Customers from France and Germany exhibit a unimodal distribution, but those from Spain seem to follow a bimodal pattern. But this may be due at least in part to the default values. The analyst may wish to explore using nondefault values:\n&gt; args(type_density)\nfunction (bw = \"nrd0\", joint.bw = c(\"mean\", \"full\", \"none\"), \n    adjust = 1, kernel = c(\"gaussian\", \"epanechnikov\", \"rectangular\", \n    \"triangular\", \"biweight\", \"cosine\", \"optcosine\"), n = 512, \n    alpha = NULL) \nThis could be done, say, by the call\n\ntinyplot(~ Balance | Geography, type=type_density(kernel='triangular'),\n   data=iranChurn)\n\n\n\n\n\n\n\n\nNot much difference.\n\n\nGeneralized linear models\nOne can also apply generalized linear models, say the logistic:\n\niranChurn$Exited &lt;- as.numeric(iranChurn$Exited == '1')\ntinyplot(Exited ~ Balance, type=type_glm(family=binomial),data=iranChurn)\n\n\n\n\n\n\n\n\nThe higher the balance, the more likely the customer is to bolt.\n\n\nThe Stanford Vocabulary dataset\nThis is a survey of vocabulary sizes of young children.\n\nlibrary(qeML)\ndata(english)\nhead(english)\n\n  data_id age language form birth_order ethnicity    sex         mom_ed\n1       1  24  English   WS       First     Asian Female       Graduate\n2       2  19  English   WS      Second     Black Female        College\n3       3  24  English   WS       First     Other   Male Some_Secondary\n4       4  18  English   WS       First     White   Male      Secondary\n5       5  24  English   WS       First     White Female      Secondary\n6       6  19  English   WS       First     Other Female   Some_College\n     measure vocab     demo    n          demo_label\n1 production   337 All Data 5498 All Data (n = 5498)\n2 production   384 All Data 5498 All Data (n = 5498)\n3 production    76 All Data 5498 All Data (n = 5498)\n4 production    19 All Data 5498 All Data (n = 5498)\n5 production   480 All Data 5498 All Data (n = 5498)\n6 production   313 All Data 5498 All Data (n = 5498)\n\neng1 &lt;- english[,c(2,5:8,10)]\nhead(eng1)\n\n  age birth_order ethnicity    sex         mom_ed vocab\n1  24       First     Asian Female       Graduate   337\n2  19      Second     Black Female        College   384\n3  24       First     Other   Male Some_Secondary    76\n4  18       First     White   Male      Secondary    19\n5  24       First     White Female      Secondary   480\n6  19       First     Other Female   Some_College   313\n\neng1 &lt;- stats::na.omit(eng1)\n\nLet’s explore the role, if any, of the mother’s educational level. For each given level, find the estimated density of vocabulary:\n\ntinyplot(~ vocab | mom_ed, type='density', data=eng1)\n\n\n\n\n\n\n\n\nMore or less as expected, though except for the Primary case, the data is largely clumped together.\nActually, the Primary case is surprisingly bimodal, so we should be suspicious. Is it due to having a small sample size for that case? Let’s check:\n\nwith(eng1,tapply(vocab,mom_ed,length))\n\n       College       Graduate        Primary      Secondary   Some_College \n           847            576              8            433            594 \n Some_Graduate Some_Secondary \n           155            128 \n\n\nRemove those cases.\n\neng2 &lt;- eng1[eng1$mom_ed != 'Primary',]\n\n\n\n\n\n\n\nSample Size Issues\n\n\n\nGraph appearance depends on sample size. If you see what appears to be an anomalous graph, check for small samples. Indeed, keep sample size in mind when noting any “interesting” plots.\n\n\nReputedly, girls are initially ahead of boys. True?\n\ntinyplot(vocab ~ age | sex, type=type_lm(se=FALSE), data=eng2)\n\n\n\n\n\n\n\n\nYes, according to this, the girls are always somewhat ahead.\nWhat about across ethnicities?\n\ntinyplot(vocab ~ age | ethnicity, type=type_lm(se=FALSE), data=eng2)\n\n\n\n\n\n\n\n\nThe different ethnicities seem to cluster into two groups, with the disparity growing with age.\nDoes the mother’s educational level make a difference?\n\ntinyplot(vocab ~ age | mom_ed, type=type_loess(se=FALSE), data=eng2)\n\n\n\n\n\n\n\n\nYes, while the initial difference is small, by age 30 months gaps have formed.\nNote that, unlike our earlier example with the census data, we see that a linear model would seem to work well here, so let’switch to that.\n\ntinyplot(vocab ~ age | mom_ed, type=type_lm(se=FALSE), data=eng2)\n\n\n\n\n\n\n\n\n\n\nUse of color gradients\nIllustration of the color gradient in the census data: Find the probability that a customer exits, given balance and number of products they use.\nRecall that for a logistic model, glm finds the probability of “Y=1”.\n\nz &lt;- glm(Exited ~ Balance + NumOfProducts,data=iranChurn,family=binomial)\niranChurn$Fit &lt;- z$fitted.values\nplt(Balance ~ NumOfProducts | Fit, data=iranChurn)\n\n\n\n\n\n\n\n\nThe fitted values are probabilities of leaving, with dark blue representing the highest probabilities and yellow-green the lowest. Customers with a lot of products seem less likely to leave, and by the way, exhibit a narrower range in balance.\nAge is always of interest:\n\nz &lt;- glm(Exited ~ Balance + Age,data=iranChurn,family=binomial)\niranChurn$Fit &lt;- z$fitted.values\nplt(Balance ~ Age | Fit, data=iranChurn)\n\n\n\n\n\n\n\n\nNice picture of a fish!\nWe see that older customers are more likely to leave, even with the same balance as younger ones.\n\n\n\n\n\n\nSubtle Change in the | Operator\n\n\n\nThe following may seem to be just a mathematical nicety, but it is actually quite important.\nWhen we first discussed the | operator, we noted that it makes sense, because | is used in probability theory for quantities like P(A|B).\n\nNatural syntax: R ‘formula’ plus ‘|’, the latter evoking conditional probability. E.g.\ntinyplot(~ wageinc | gender, data=svcensus,type='density')\nspecifies that we plot the conditional density of income, given gender.\n\nHere in the current section on color gradients, we are still using | – but in the reverse direction! E.g. in the code\nplt(Balance ~ Age | Fit, data=iranChurn)\nwe are displaying the (estimated) conditional probability of Exit, given Balance and Age. In other words, the conditioning quantity is now before the |, not after it.\n\n\n\n\nLayering\nHere one builds up a plot one aspect at a time, literally layer by layer. The analyst may have pre-planned this, to show the effects of adding material to a plot one step at a time, or it could arise as a sudden inspiration, “Hey, what if we add such and such?”\nAs an example, let’s revisit one of our earlier operations:\n\ntinyplot(wageinc ~ age | gender, type=type_lm(se=FALSE),data=svcensus)\n\n\n\n\n\n\n\n\nAll is well and good, right? But…the analyst may suddenly think, “Should we be using linear models here?” He/she can then add nonparametric estimates of the curves, superimposing them on the original:\ntinyplot_add(type='loess')\n\n\n\nsuperimposed curves\n\n\nOf course, layering is often used for annotation."
  }
]